<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advisor Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            left: 0;
            top: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 0 2rem 2rem 2rem;
            border-bottom: 2px solid #e1e5e9;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .advisor-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* User Profile Styles */
.user-profile {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: linear-gradient(135deg, #e8f4f8 0%, #d6eaf8 100%);
    border-radius: 12px;
    margin-bottom: 1rem;
}

.user-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.25rem;
    flex-shrink: 0;
}

.user-info {
    flex: 1;
    min-width: 0;
}

.user-name {
    font-size: 1rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.user-role {
    font-size: 0.75rem;
    color: #5a6c7d;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Client Selector Styles */
.client-selector {
    margin-bottom: 1rem;
}

.client-selector label {
    display: block;
    font-size: 0.85rem;
    color: #5a6c7d;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.client-dropdown {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 0.95rem;
    color: #2c3e50;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
}

.client-dropdown:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.client-dropdown:hover {
    border-color: #3498db;
}

.viewing-client {
    padding: 0.75rem;
    background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
    color: white;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-size: 0.85rem;
    font-weight: 600;
    text-align: center;
}
        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            padding: 0 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #95a5a6;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.8rem 2rem;
            color: #5a6c7d;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .nav-item:hover {
            background: #f8f9fa;
            color: #2c3e50;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            font-weight: 600;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #2980b9;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 1rem;
            font-size: 1.2rem;
        }
      .sidebar-footer {
    margin-top: auto;
    padding: 1.5rem 2rem;
    border-top: 2px solid #e1e5e9;
    background: white;
}

.logout-link {
    display: flex;
    align-items: center;
    padding: 0.8rem 0;
    color: #e74c3c;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s ease;
}

.logout-link:hover {
    color: #c0392b;
    padding-left: 0.5rem;
}

.logout-icon {
    margin-right: 0.75rem;
    font-size: 1.2rem;
}

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .page-header h2 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #7f8c8d;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .sprint-info {
            display: flex;
            gap: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .sprint-info-item {
            display: flex;
            flex-direction: column;
        }

        .sprint-info-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 0.25rem;
        }

        .sprint-info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .stat-icon {
            font-size: 2rem;
            opacity: 0.6;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .stat-trend {
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .trend-up {
            color: #27ae60;
        }

        .trend-down {
            color: #e74c3c;
        }

        .trend-neutral {
            color: #7f8c8d;
        }

        /* Two Column Layout */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Full Width Section */
        .full-width {
            margin-bottom: 2rem;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 2px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        .card-header h3 {
            font-size: 1.25rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-body {
            padding: 2rem;
            max-height: 500px;
            overflow-y: auto;
        }

        /* Button Styles */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #3498db;
            border: 2px solid #3498db;
        }

        .btn-secondary:hover {
            background: #3498db;
            color: white;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .btn-icon {
            padding: 0.5rem;
            background: transparent;
            color: white;
            font-size: 1.2rem;
        }

        .btn-icon:hover {
            background: rgba(255,255,255,0.1);
            transform: none;
        }

        /* Tasks Section */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-item {
            padding: 1.25rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .task-item:hover {
            border-color: #3498db;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .task-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .task-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }

        .task-description {
            color: #5a6c7d;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-todo {
            background: #ecf0f1;
            color: #5a6c7d;
        }

        .status-in-progress,
        .status-on-track {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-completed,
        .status-finished {
            background: #d1f2eb;
            color: #16a085;
        }

        .status-blocked {
            background: #fef5e7;
            color: #f39c12;
        }

        .status-off-track {
            background: #fadbd8;
            color: #e74c3c;
        }

        .priority-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .priority-high {
            background: #fadbd8;
            color: #e74c3c;
        }

        .priority-medium {
            background: #fef5e7;
            color: #f39c12;
        }

        .priority-low {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        /* Blockers Section */
        .blocker-item {
            padding: 1.25rem;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .blocker-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .blocker-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .blocker-description {
            color: #856404;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .blocker-meta {
            font-size: 0.85rem;
            color: #856404;
            opacity: 0.8;
        }

        /* Files Section */
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .file-item {
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .file-icon {
            font-size: 2rem;
            opacity: 0.6;
        }

        .file-details h4 {
            font-size: 1rem;
            color: #2c3e50;
            margin-bottom: 0.25rem;
        }

        .file-details p {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        /* Discussion/Notes Section */
        .discussion-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .discussion-item {
            padding: 1.25rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
        }

        .discussion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .discussion-author {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .discussion-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }

        .discussion-author-info h4 {
            font-size: 0.95rem;
            color: #2c3e50;
            margin-bottom: 0.15rem;
        }

        .discussion-author-info p {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .discussion-content {
            color: #5a6c7d;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .discussion-input {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .discussion-textarea {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            resize: vertical;
            min-height: 100px;
        }

        .discussion-textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: #7f8c8d;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e1e5e9;
            border-top-color: #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connected {
            background: #27ae60;
        }

        .status-error {
            background: #e74c3c;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
    <h1>Growth Manager Pro</h1>
    
    <!-- User Profile -->
    <div class="user-profile">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-info">
            <div class="user-name" id="userName">Loading...</div>
            <div class="user-role" id="userRole">Advisor</div>
        </div>
    </div>
    
    <!-- Client Selector -->
    <div class="client-selector" id="clientSelector">
        <label for="clientDropdown">üìä View Client:</label>
        <select id="clientDropdown" class="client-dropdown" onchange="switchClient(this.value)">
            <option value="">Select a client...</option>
        </select>
    </div>
</div>

    <a href="sprints.html" class="nav-item">
        <span class="nav-icon">‚ö°</span>
        Sprints Workspace
    </a>
    
        <a href="sprints.html" class="nav-item">
            <span class="nav-icon">‚úÖ</span>
            <span>My Tasks</span>
        </a>
            <div class="nav-section">
    <div class="nav-section-title">Admin</div>
    <a href="dashboard.html" class="nav-item">
        <span class="nav-icon">üìä</span>
        <span>Back to Dashboard</span>
    </a>
            
    <a href="client-dashboard.html" class="nav-item">
        <span class="nav-icon">üë§</span>
        <span>Client Dashboard</span>
    </a>
</div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Navigation</div>
                    <a href="advisor-dashboard.html" class="nav-item active">
                        <span class="nav-icon">üìä</span>
                        <span>Dashboard</span>
                    </a>
                    <a href="javascript:void(0)" class="nav-item" onclick="scrollToSection('discussion')">
                        <span class="nav-icon">üí¨</span>
                        <span>Discussion</span>
                    </a>
                    <a href="javascript:void(0)" class="nav-item" onclick="scrollToSection('files')">
                        <span class="nav-icon">üìÅ</span>
                        <span>Files</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Account</div>
                    <a href="login.html" class="nav-item">
                        <span class="nav-icon">üö™</span>
                        <span>Logout</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <h2>Advisor Dashboard</h2>
                <p class="page-subtitle">Track progress, identify blockers, and collaborate on business growth</p>
                
                <div class="sprint-info">
                    <div class="sprint-info-item">
                        <span class="sprint-info-label">Current Sprint</span>
                        <span class="sprint-info-value" id="current-sprint">Loading...</span>
                    </div>
                    <div class="sprint-info-item">
                        <span class="sprint-info-label">Sprint Period</span>
                        <span class="sprint-info-value" id="sprint-period">Loading...</span>
                    </div>
                    <div class="sprint-info-item">
                        <span class="sprint-info-label">Days Remaining</span>
                        <span class="sprint-info-value" id="days-remaining">Loading...</span>
                    </div>
                    <div class="sprint-info-item">
                        <span class="sprint-info-label">Last Updated</span>
                        <span class="sprint-info-value" id="last-updated">Just now</span>
                    </div>
                </div>
            </div>

            <!-- Stats Grid - Maggie's Business Metrics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Podcast Calls</div>
                            <div class="stat-value" id="stat-podcast">0</div>
                            <div class="stat-trend trend-up">
                                <span>‚Üë</span>
                                <span id="podcast-trend">This week</span>
                            </div>
                        </div>
                        <div class="stat-icon">üéôÔ∏è</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Discovery Calls</div>
                            <div class="stat-value" id="stat-discovery">0</div>
                            <div class="stat-trend trend-up">
                                <span>‚Üë</span>
                                <span id="discovery-trend">This week</span>
                            </div>
                        </div>
                        <div class="stat-icon">üìû</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Tasks Completed</div>
                            <div class="stat-value" id="stat-tasks">0</div>
                            <div class="stat-trend trend-neutral">
                                <span id="tasks-trend">of 0 total</span>
                            </div>
                        </div>
                        <div class="stat-icon">‚úÖ</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Pipeline Health</div>
                            <div class="stat-value" id="stat-pipeline">0%</div>
                            <div class="stat-trend trend-up">
                                <span>‚Üë</span>
                                <span>On track</span>
                            </div>
                        </div>
                        <div class="stat-icon">üìà</div>
                    </div>
                </div>
            </div>

            <!-- Two Column Layout: Tasks & Blockers -->
            <div class="two-column">
                <!-- Tasks Section -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <span>‚úÖ</span>
                            <span>Current Tasks</span>
                        </h3>
                        <div class="card-actions">
                            <button class="btn btn-icon" onclick="refreshTasks()" title="Refresh">üîÑ</button>
                            <button class="btn btn-small btn-primary" onclick="addNote('task')">üí¨ Add Note</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="tasks-list" class="task-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>Loading tasks...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blockers Section -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <span>üö®</span>
                            <span>Active Blockers</span>
                        </h3>
                        <div class="card-actions">
                            <button class="btn btn-icon" onclick="refreshBlockers()" title="Refresh">üîÑ</button>
                            <button class="btn btn-small btn-primary" onclick="suggestSolution()">üí° Suggest Solution</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="blockers-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>Loading blockers...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Full Width: Discussion/Notes -->
            <div class="full-width" id="discussion">
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <span>üí¨</span>
                            <span>Discussion & Notes</span>
                        </h3>
                        <div class="card-actions">
                            <button class="btn btn-icon" onclick="refreshDiscussion()" title="Refresh">üîÑ</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Add Note Form -->
                        <div class="discussion-input">
                            <textarea 
                                id="note-input" 
                                class="discussion-textarea" 
                                placeholder="Add a note, question, or suggestion for Maggie..."
                            ></textarea>
                            <button class="btn btn-primary" onclick="postNote()">üìù Post Note</button>
                        </div>

                        <!-- Discussion List -->
                        <div id="discussion-list" class="discussion-list" style="margin-top: 2rem;">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>Loading discussion...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Full Width: Shared Files -->
            <div class="full-width" id="files">
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <span>üìÅ</span>
                            <span>Shared Files</span>
                        </h3>
                        <div class="card-actions">
                            <button class="btn btn-icon" onclick="refreshFiles()" title="Refresh">üîÑ</button>
                            <button class="btn btn-small btn-primary" onclick="uploadFile()">üì§ Upload File</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="files-list" class="file-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>Loading files...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Connection Status -->
        <div class="connection-status">
            <div class="status-indicator status-connected" id="status-indicator"></div>
            <span id="status-text">Live Connected</span>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="file-input" style="display: none;" onchange="handleFileUpload()">


     <script src="auth-helper.js"></script>
    
     <script>
    // ============================================
// ADVISOR DASHBOARD - CORRECTED SCRIPT
// ============================================
// Replace the entire <script> section in advisor-dashboard.html with this

// DECLARE VARIABLES FIRST
const API_BASE = 'https://growthmanagerpro-backend.vercel.app';
const API_URL = 'https://growthmanagerpro-backend.vercel.app';

// Data stores
let tasksData = [];
let blockersData = [];
let discussionData = [];
let filesData = [];

// ============================================
// PROFILE & CLIENT SELECTOR FUNCTIONS (GLOBAL)
// ============================================

// Update profile indicator
function updateProfileIndicator() {
    const userData = localStorage.getItem('user');
    if (userData) {
        const user = JSON.parse(userData);
        const userName = user.full_name || user.name || 'Advisor';
        document.getElementById('userName').textContent = userName;
        const initials = userName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        document.getElementById('userAvatar').textContent = initials;
        const role = user.role || user.type || 'advisor';
        const roleNames = {
            'consultant': 'üíº Consultant',
            'advisor': 'üéØ Advisor'
        };
        document.getElementById('userRole').textContent = roleNames[role] || 'Advisor';
    }
}

// Load client list
async function loadClientList() {
    try {
        const response = await fetch(`${API_BASE}/api/advisor/clients`);
        const result = await response.json();
        if (result.success && result.clients) {
            const dropdown = document.getElementById('clientDropdown');
            dropdown.innerHTML = '<option value="">My Dashboard (All Clients)</option>';
            result.clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.company_name || client.name || 'Unnamed Client';
                dropdown.appendChild(option);
            });
        }
    } catch (error) {
        console.error('Error loading clients:', error);
    }
}

// Switch client view
function switchClient(clientId) {
    if (!clientId) {
        localStorage.removeItem('viewingClientId');
        document.getElementById('viewingClientIndicator')?.remove();
        return;
    }
    localStorage.setItem('viewingClientId', clientId);
    const dropdown = document.getElementById('clientDropdown');
    const clientName = dropdown.options[dropdown.selectedIndex].text;
    let indicator = document.getElementById('viewingClientIndicator');
    if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'viewingClientIndicator';
        indicator.className = 'viewing-client';
        document.getElementById('clientSelector').after(indicator);
    }
    indicator.innerHTML = `üëÅÔ∏è Viewing: ${clientName}`;
    alert(`Switched to viewing: ${clientName}\n\nClient-specific data loading will be added next.`);
}

// ============================================
// INITIALIZATION
// ============================================

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    console.log('[Advisor Dashboard] Initializing...');
    
    // Initialize profile and client selector
    updateProfileIndicator();
    loadClientList();
    
    // Load all dashboard data
    loadAllData();
    
    // Auto-refresh every 2 minutes
    setInterval(loadAllData, 2 * 60 * 1000);
});

// ============================================
// DATA LOADING FUNCTIONS
// ============================================

async function loadAllData() {
    updateConnectionStatus('connecting');
    
    try {
        await Promise.all([
            loadStats(),
            loadTasks(),
            loadBlockers(),
            loadDiscussion(),
            loadFiles()
        ]);
        
        updateConnectionStatus('connected');
        updateLastUpdated();
    } catch (error) {
        console.error('[Advisor Dashboard] Error loading data:', error);
        updateConnectionStatus('error');
    }
}

async function loadStats() {
    try {
        const response = await fetch(`${API_URL}/api/sprints/stats`);
        if (!response.ok) throw new Error('Failed to load stats');
        
        const result = await response.json();
        const stats = result.stats || {};
        
        // Update stat cards
        document.getElementById('stat-podcast').textContent = stats.podcast_calls || 0;
        document.getElementById('stat-discovery').textContent = stats.discovery_calls || 0;
        document.getElementById('stat-tasks').textContent = stats.tasks_completed || 0;
        document.getElementById('tasks-trend').textContent = `of ${stats.tasks_total || 0} total`;
        
        // Calculate pipeline health
        const pipelineHealth = stats.leads_generated > 0 
            ? Math.min(100, Math.round((stats.discovery_calls / stats.leads_generated) * 100))
            : 0;
        document.getElementById('stat-pipeline').textContent = pipelineHealth + '%';
        
        // Update sprint info
        document.getElementById('current-sprint').textContent = 'Sprint ' + (new Date().getWeek() || 1);
        document.getElementById('sprint-period').textContent = getCurrentSprintPeriod();
        document.getElementById('days-remaining').textContent = getDaysRemainingInWeek() + ' days';
    } catch (error) {
        console.error('[Advisor Dashboard] Error loading stats:', error);
    }
}

async function loadTasks() {
    try {
        const response = await fetch(`${API_URL}/api/sprints/tasks`);
        if (!response.ok) throw new Error('Failed to load tasks');
        
        const result = await response.json();
        tasksData = result.tasks || [];
        renderTasks();
    } catch (error) {
        console.error('[Advisor Dashboard] Error loading tasks:', error);
        renderTasksError();
    }
}

function renderTasks() {
    const container = document.getElementById('tasks-list');
    
    if (tasksData.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>‚úÖ All Caught Up!</h3>
                <p>No active tasks at the moment</p>
            </div>
        `;
        return;
    }

    const relevantTasks = tasksData.filter(t => 
        t.status === 'in-progress' || 
        t.status === 'on-track' || 
        t.status === 'blocked' ||
        t.status === 'off-track'
    );

    if (relevantTasks.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>‚úÖ Everything Running Smoothly!</h3>
                <p>No tasks needing advisor support</p>
            </div>
        `;
        return;
    }

    container.innerHTML = relevantTasks.slice(0, 10).map(task => `
        <div class="task-item">
            <div class="task-header">
                <div>
                    <h4 class="task-title">${task.title || 'Untitled Task'}</h4>
                    <div class="task-meta">
                        <span>üë§ ${task.assigned_to || 'Maggie'}</span>
                        ${task.due_date ? `<span>üìÖ Due: ${formatDate(task.due_date)}</span>` : ''}
                        ${task.priority ? `<span class="priority-badge priority-${task.priority}">${task.priority}</span>` : ''}
                    </div>
                </div>
                <span class="status-badge status-${task.status}">${task.status}</span>
            </div>
            ${task.description ? `<p class="task-description">${task.description}</p>` : ''}
            <div class="task-actions">
                <button class="btn btn-small btn-secondary" onclick="addNote('task', '${task.id}')">
                    üí¨ Add Note
                </button>
                ${task.status === 'blocked' ? `
                    <button class="btn btn-small btn-success" onclick="suggestSolution('${task.id}')">
                        üí° Suggest Solution
                    </button>
                ` : ''}
            </div>
        </div>
    `).join('');
}

function renderTasksError() {
    document.getElementById('tasks-list').innerHTML = `
        <div class="empty-state">
            <h3>‚ö†Ô∏è Unable to load tasks</h3>
            <button class="btn btn-primary" onclick="loadTasks()">Retry</button>
        </div>
    `;
}

async function loadBlockers() {
    try {
        const response = await fetch(`${API_URL}/api/sprints/blockers`);
        if (!response.ok) throw new Error('Failed to load blockers');
        
        const result = await response.json();
        blockersData = result.blockers || [];
        renderBlockers();
    } catch (error) {
        console.error('[Advisor Dashboard] Error loading blockers:', error);
        renderBlockersError();
    }
}

function renderBlockers() {
    const container = document.getElementById('blockers-list');
    
    if (blockersData.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>üéâ No Blockers!</h3>
                <p>Everything is flowing smoothly</p>
            </div>
        `;
        return;
    }

    container.innerHTML = blockersData.map(blocker => `
        <div class="blocker-item">
            <div class="blocker-header">
                <div class="blocker-title">
                    <span>‚ö†Ô∏è</span>
                    <span>${blocker.title}</span>
                </div>
            </div>
            <p class="blocker-description">${blocker.description}</p>
            <div class="blocker-meta">
                Reported ${formatDate(blocker.created_at)}
            </div>
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                <button class="btn btn-small btn-primary" onclick="suggestSolution('${blocker.id}')">
                    üí° Suggest Solution
                </button>
                <button class="btn btn-small btn-secondary" onclick="addNote('blocker', '${blocker.id}')">
                    üí¨ Add Note
                </button>
            </div>
        </div>
    `).join('');
}

function renderBlockersError() {
    document.getElementById('blockers-list').innerHTML = `
        <div class="empty-state">
            <h3>‚ö†Ô∏è Unable to load blockers</h3>
            <button class="btn btn-primary" onclick="loadBlockers()">Retry</button>
        </div>
    `;
}

async function loadDiscussion() {
    try {
        const response = await fetch(`${API_URL}/api/advisor/discussion`);
        if (!response.ok) throw new Error('Failed to load discussion');
        
        const result = await response.json();
        discussionData = result.notes || [];
        renderDiscussion();
    } catch (error) {
        console.error('[Advisor Dashboard] Error loading discussion:', error);
        discussionData = [
            {
                id: 1,
                author: 'Maggie Forbes',
                role: 'admin',
                content: 'Starting this week with focus on podcast outreach and follow-ups!',
                created_at: new Date().toISOString()
            }
        ];
        renderDiscussion();
    }
}

function renderDiscussion() {
    const container = document.getElementById('discussion-list');
    
    if (discussionData.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <p>No discussion yet. Start the conversation!</p>
            </div>
        `;
        return;
    }

    container.innerHTML = discussionData.slice(0, 10).reverse().map(note => {
        const initials = note.author.split(' ').map(n => n[0]).join('').toUpperCase();
        return `
            <div class="discussion-item">
                <div class="discussion-header">
                    <div class="discussion-author">
                        <div class="discussion-avatar">${initials}</div>
                        <div class="discussion-author-info">
                            <h4>${note.author}</h4>
                            <p>${formatRelativeTime(note.created_at)}</p>
                        </div>
                    </div>
                </div>
                <p class="discussion-content">${note.content}</p>
            </div>
        `;
    }).join('');
}

         
async function loadFiles() {
    try {
        // Get advisor ID
        const userData = localStorage.getItem('user');
        if (!userData) return;
        const user = JSON.parse(userData);
        
        // Get client ID if viewing specific client
        const viewingClientId = localStorage.getItem('viewingClientId');
        
        const url = viewingClientId 
            ? `${API_URL}/api/advisor/files?advisorId=${user.id}&clientId=${viewingClientId}`
            : `${API_URL}/api/advisor/files?advisorId=${user.id}`;
            
        const response = await fetch(url);
        
        if (!response.ok) throw new Error('Failed to load files');
        
        const result = await response.json();
        filesData = result.files || [];
        renderFiles();
    } catch (error) {
        console.error('[Advisor Dashboard] Error loading files:', error);
        renderFilesError();
    }
}

function renderFiles() {
    const container = document.getElementById('files-list');
    
    if (filesData.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>üìÅ No Files Yet</h3>
                <p>Upload documents to share with Maggie</p>
                <button class="btn btn-primary" onclick="uploadFile()">üì§ Upload First File</button>
            </div>
        `;
        return;
    }

    container.innerHTML = filesData.map(file => `
        <div class="file-item">
            <div class="file-info">
                <div class="file-icon">üìÑ</div>
                <div class="file-details">
                    <h4>${file.filename}</h4>
                    <p>Uploaded ${formatDate(file.created_at)} ‚Ä¢ ${file.uploaded_by}</p>
                </div>
            </div>
            <button class="btn btn-small btn-secondary" onclick="downloadFile('${file.id}')">
                ‚¨áÔ∏è Download
            </button>
        </div>
    `).join('');
}

function renderFilesError() {
    document.getElementById('files-list').innerHTML = `
        <div class="empty-state">
            <h3>‚ö†Ô∏è Unable to load files</h3>
            <button class="btn btn-primary" onclick="loadFiles()">Retry</button>
        </div>
    `;
}

// ============================================
// ACTION FUNCTIONS
// ============================================

async function postNote() {
    const input = document.getElementById('note-input');
    const content = input.value.trim();
    
    if (!content) {
        alert('Please enter a note before posting.');
        return;
    }
    
    try {
        const response = await fetch(`${API_URL}/api/advisor/discussion`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                content,
                author: 'Advisor',
                role: 'advisor'
            })
        });

        if (!response.ok) throw new Error('Failed to post note');

        input.value = '';
        await loadDiscussion();
    } catch (error) {
        console.error('[Advisor Dashboard] Error posting note:', error);
        alert('Failed to post note. Please try again.');
    }
}

function addNote(type, id) {
    const note = prompt(`Add a note about this ${type}:`);
    if (!note) return;
    
    alert(`‚úÖ Note added!\n\n"${note}"\n\nThis will be visible to Maggie in her dashboard.`);
    console.log('Adding note:', { type, id, note });
}

function suggestSolution(id) {
    const solution = prompt('Suggest a solution for this blocker:');
    if (!solution) return;
    
    alert(`üí° Solution suggested!\n\n"${solution}"\n\nMaggie will receive a notification about your suggestion.`);
    console.log('Suggesting solution:', { id, solution });
}

function uploadFile() {
    document.getElementById('file-input').click();
}

// REPLACE handleFileUpload() function in advisor-dashboard.html with this:

async function handleFileUpload() {
    const input = document.getElementById('file-input');
    const files = input.files;
    
    if (files.length === 0) return;

    const file = files[0];
    
    // Validate file size (10MB limit)
    if (file.size > 10 * 1024 * 1024) {
        alert('‚ùå File too large. Maximum size is 10MB.');
        input.value = '';
        return;
    }

    try {
        // Get advisor ID from logged-in user
        const userData = localStorage.getItem('user');
        if (!userData) {
            alert('‚ùå Not logged in');
            return;
        }
        const user = JSON.parse(userData);
        const advisorId = user.id;

        // Get client ID if viewing a specific client
        const viewingClientId = localStorage.getItem('viewingClientId');

        // Show uploading message
        const uploadButton = document.querySelector('button[onclick="uploadFile()"]');
        const originalText = uploadButton.textContent;
        uploadButton.textContent = '‚è≥ Uploading...';
        uploadButton.disabled = true;

        // Create FormData
        const formData = new FormData();
        formData.append('file', file);
        formData.append('advisorId', advisorId);
        if (viewingClientId) {
            formData.append('clientId', viewingClientId);
        }

        // Upload file
        const response = await fetch(`${API_BASE}/api/advisor/upload-file`, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (!result.success) {
            throw new Error(result.error || 'Upload failed');
        }

        console.log('[File Upload] ‚úÖ Success:', result.file);

        // Show success message
        alert(`‚úÖ ${file.name} uploaded successfully!`);

        // Reload files list
        await loadFiles();

        // Reset button
        uploadButton.textContent = originalText;
        uploadButton.disabled = false;

    } catch (error) {
        console.error('[File Upload] Error:', error);
        alert(`‚ùå Upload failed: ${error.message}`);
        
        // Reset button
        const uploadButton = document.querySelector('button[onclick="uploadFile()"]');
        uploadButton.textContent = 'üì§ Upload File';
        uploadButton.disabled = false;
    } finally {
        // Clear input
        input.value = '';
    }
}

function downloadFile(fileId) {
    alert('üì• Downloading file...');
    console.log('Downloading file:', fileId);
}

function refreshTasks() {
    loadTasks();
}

function refreshBlockers() {
    loadBlockers();
}

function refreshDiscussion() {
    loadDiscussion();
}

function refreshFiles() {
    loadFiles();
}

// ============================================
// UTILITY FUNCTIONS
// ============================================

function updateConnectionStatus(status) {
    const indicator = document.getElementById('status-indicator');
    const text = document.getElementById('status-text');
    
    if (status === 'connected') {
        indicator.className = 'status-indicator status-connected';
        text.textContent = 'Live Connected';
    } else if (status === 'error') {
        indicator.className = 'status-indicator status-error';
        text.textContent = 'Connection Error';
    } else if (status === 'connecting') {
        indicator.className = 'status-indicator';
        indicator.style.background = '#f39c12';
        text.textContent = 'Connecting...';
    }
}

function updateLastUpdated() {
    const now = new Date();
    document.getElementById('last-updated').textContent = now.toLocaleTimeString();
}

function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric',
        year: 'numeric'
    });
}

function formatRelativeTime(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    const now = new Date();
    const diff = now - date;
    const hours = Math.floor(diff / 3600000);
    
    if (hours < 1) return 'Just now';
    if (hours < 24) return `${hours}h ago`;
    if (hours < 48) return 'Yesterday';
    
    const days = Math.floor(hours / 24);
    if (days < 7) return `${days}d ago`;
    
    return formatDate(dateString);
}

function getCurrentSprintPeriod() {
    const now = new Date();
    const startOfWeek = new Date(now);
    startOfWeek.setDate(now.getDate() - now.getDay());
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6);
    
    return `${startOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${endOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
}

function getDaysRemainingInWeek() {
    const now = new Date();
    const dayOfWeek = now.getDay();
    return 7 - dayOfWeek;
}

Date.prototype.getWeek = function() {
    const onejan = new Date(this.getFullYear(), 0, 1);
    return Math.ceil((((this - onejan) / 86400000) + onejan.getDay() + 1) / 7);
};

function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

console.log('[Advisor Dashboard] System initialized');
console.log('[Advisor Dashboard] API Endpoint:', API_URL);
